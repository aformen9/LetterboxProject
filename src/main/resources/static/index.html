<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letterbox Project</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #14181c; color: #fff; margin: 0; padding: 20px; }
        h1, h2 { color: #00c030; border-bottom: 2px solid #445566; padding-bottom: 10px; }
        .container { max-width: 900px; margin: auto; }
        .movie-list, .review-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .movie-card, .review-card { background-color: #2c3440; border-radius: 8px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .movie-card h3 { margin-top: 0; }
        .review-card p { margin: 5px 0; }
        .review-card .rating { font-weight: bold; color: #00e054; }
        form { background-color: #2c3440; padding: 20px; border-radius: 8px; margin-top: 20px; }
        form input, form textarea, form select { width: calc(100% - 20px); padding: 10px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #445566; background-color: #1f252c; color: #fff; }
        form button { background-color: #00c030; color: #fff; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        form button:hover { background-color: #00e054; }
    </style>
</head>
<body>

<div class="container">
    <h1>üé¨ Letterbox Project</h1>

    <h2>Pel√≠culas</h2>
    <div id="movie-list" class="movie-list"></div>

    <h2>A√±adir Nueva Rese√±a</h2>
    <form id="review-form">
        <label for="movie-select">Selecciona una pel√≠cula:</label>
        <select id="movie-select" required></select>

        <label for="reviewer-name">Tu Nombre:</label>
        <input type="text" id="reviewer-name" required>

        <label for="rating">Calificaci√≥n (1-5):</label>
        <input type="number" id="rating" min="1" max="5" step="0.5" required>

        <label for="comment">Comentario:</label>
        <textarea id="comment" rows="4" required></textarea>

        <button type="submit">Enviar Rese√±a</button>
    </form>

    <h2>√öltimas Rese√±as</h2>
    <div id="review-list" class="review-list"></div>
</div>

<script>
    // URLs de la API, como especifica el documento [cite: 474, 475]
    const MOVIE_API = 'http://localhost:8080/api/movies';
    const REVIEW_API = 'http://localhost:8080/api/reviews';

    const movieList = document.getElementById('movie-list');
    const reviewList = document.getElementById('review-list');
    const movieSelect = document.getElementById('movie-select');
    const reviewForm = document.getElementById('review-form');

    // Funci√≥n para cargar las pel√≠culas
    async function loadMovies() {
        try {
            const response = await fetch(MOVIE_API);
            const movies = await response.json();

            movieList.innerHTML = '';
            movieSelect.innerHTML = '<option value="">Cargando...</option>';

            movies.forEach(movie => {
                // A√±adir a la lista de pel√≠culas
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card';
                movieCard.innerHTML = `
                    <h3>${movie.title} (${movie.year})</h3>
                    <p><strong>Director:</strong> ${movie.director}</p>
                    <p><em>${movie.synopsis}</em></p>
                `;
                movieList.appendChild(movieCard);

                // A√±adir al selector del formulario
                const option = document.createElement('option');
                option.value = movie.id;
                option.textContent = movie.title;
                movieSelect.appendChild(option);
            });
        } catch (error) {
            console.error('Error cargando pel√≠culas:', error);
            movieList.innerHTML = '<p>No se pudieron cargar las pel√≠culas.</p>';
        }
    }

    // Funci√≥n para cargar las rese√±as
    async function loadReviews() {
        try {
            const response = await fetch(REVIEW_API);
            const reviews = await response.json();

            reviewList.innerHTML = '';
            reviews.forEach(review => {
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                reviewCard.innerHTML = `
                    <p class="rating">‚òÖ ${review.rating}</p>
                    <p><strong>${review.reviewerName}</strong> coment√≥:</p>
                    <p>"${review.comment}"</p>
                    <small>${new Date(review.reviewDate).toLocaleDateString()}</small>
                `;
                reviewList.appendChild(reviewCard);
            });
        } catch (error) {
            console.error('Error cargando rese√±as:', error);
            reviewList.innerHTML = '<p>No se pudieron cargar las rese√±as.</p>';
        }
    }

    // Evento para enviar el formulario de nueva rese√±a
    reviewForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const newReview = {
            movield: document.getElementById('movie-select').value,
            reviewerName: document.getElementById('reviewer-name').value,
            rating: parseFloat(document.getElementById('rating').value),
            comment: document.getElementById('comment').value
        };

        try {
            await fetch(REVIEW_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newReview)
            });

            reviewForm.reset();
            loadReviews(); // Recargar las rese√±as para ver la nueva
        } catch (error) {
            console.error('Error al enviar la rese√±a:', error);
        }
    });

    // Cargar todo al iniciar la p√°gina
    document.addEventListener('DOMContentLoaded', () => {
        loadMovies();
        loadReviews();
    });
</script>

</body>
</html>